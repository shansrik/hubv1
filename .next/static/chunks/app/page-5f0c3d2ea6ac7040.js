(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{124:function(e,t,n){Promise.resolve().then(n.bind(n,4617))},1397:function(e,t,n){"use strict";n.d(t,{Yh:function(){return s},iC:function(){return i},loadPhotosFromStorage:function(){return r},yF:function(){return c}});let a=[{id:"image_e9f1",path:"/placeholder.svg?height=200&width=200",name:"Sample Photo 1",description:"Sample description",tags:["sample","placeholder"]},{id:"image_db91",path:"https://images.unsplash.com/photo-1497366754035-f200968a6e72?w=800&h=600&fit=crop",name:"Office Interior",description:"Modern office space with natural lighting",tags:["office","interior","lighting","windows","workplace"]},{id:"image_bb59",path:"https://images.unsplash.com/photo-1497366811353-6870744d04b2?w=800&h=600&fit=crop",name:"Conference Room",description:"Large conference room with glass walls",tags:["conference","meeting","office","glass","table"]},{id:"image_ae40",path:"https://images.unsplash.com/photo-1524758631624-e2822e304c36?w=800&h=600&fit=crop",name:"Workspace",description:"Minimalist workspace with desk",tags:["desk","workspace","minimal","work","office"]},{id:"image_cf72",path:"https://images.unsplash.com/photo-1565538810643-b5bdb714032a?w=800&h=600&fit=crop",name:"Roof Structure",description:"Wood roof structure with beams and supports",tags:["roof","structure","wood","beams","construction"]},{id:"image_df23",path:"https://images.unsplash.com/photo-1558442074-3c19857bc1dc?w=800&h=600&fit=crop",name:"Foundation Wall",description:"Concrete foundation wall with waterproofing",tags:["foundation","wall","concrete","waterproofing","basement"]},{id:"image_ef88",path:"https://images.unsplash.com/photo-1572120360610-d971b9d7767c?w=800&h=600&fit=crop",name:"HVAC System",description:"Modern HVAC system in mechanical room",tags:["hvac","mechanical","systems","air","ventilation","heating"]},{id:"image_ff99",path:"https://images.unsplash.com/photo-1504328345606-18bbc8c9d7d1?w=800&h=600&fit=crop",name:"Electrical Panel",description:"Main electrical distribution panel with breakers",tags:["electrical","panel","breakers","power","wiring"]}],o="report-editor-photos",i=()=>"upload_".concat(Date.now(),"_").concat(Math.random().toString(16).slice(2,8)),r=()=>{try{let e=localStorage.getItem(o);if(e)return JSON.parse(e);return a}catch(e){return console.error("Error loading photos from localStorage:",e),a}},s=e=>{try{return localStorage.setItem(o,JSON.stringify(e)),!0}catch(e){return console.error("Error saving photos to localStorage:",e),!1}},l=(e,t)=>{if(!t||""===t.trim())return 1;let n=t.toLowerCase(),a=n.split(/\s+/).filter(e=>e.length>2),o=0,i=["the","and","for","with","this","that","from","have","has"],r=a.filter(e=>!i.includes(e));return r.forEach(t=>{e.name.toLowerCase().includes(t)&&(o+=2)}),r.forEach(t=>{e.description&&e.description.toLowerCase().includes(t)&&(o+=1)}),e.tags&&e.tags.length>0&&e.tags.forEach(e=>{n.includes(e.toLowerCase())&&(o+=5),r.forEach(t=>{(e.toLowerCase().includes(t)||t.includes(e.toLowerCase()))&&(o+=3)})}),Math.max(0,o)},c=(e,t,n)=>{let a=[...e];if(t){let e=t.toLowerCase();a=a.filter(t=>t.id.toLowerCase().includes(e)||t.name.toLowerCase().includes(e)||!!t.description&&t.description.toLowerCase().includes(e)||t.tags&&t.tags.some(t=>t.toLowerCase().includes(e)))}return n&&(a=a.map(e=>({...e,relevance:l(e,n)}))).sort((e,t)=>(t.relevance||0)-(e.relevance||0)),a}},4617:function(e,t,n){"use strict";n.d(t,{default:function(){return eh}});var a=n(7437),o=n(2265),i=n(3113),r=n(4942),s=n(7625),l=n(5675),c=n(9397),d=n(875),u=n(3581),h=n(3145),m=n(7689),p=n(7168),g=n(3247),f=n(5802),x=n(3391),v=n(8930),b=n(7053),y=n(535),w=n(4508);let N=(0,y.j)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),j=o.forwardRef((e,t)=>{let{className:n,variant:o,size:i,asChild:r=!1,...s}=e,l=r?b.g7:"button";return(0,a.jsx)(l,{className:(0,w.cn)(N({variant:o,size:i,className:n})),ref:t,...s})});j.displayName="Button";var E=n(7992),C=n(1397);function P(e){let{filterQuery:t,headingContext:n,selectedPhotos:i,onSelectPhoto:r}=e,{toast:s}=(0,E.p)(),[l,c]=(0,o.useState)([]),[d,u]=(0,o.useState)([]),[b,y]=(0,o.useState)(!1),[w,N]=(0,o.useState)(1),P=(0,o.useRef)(null);(0,o.useEffect)(()=>{c((0,C.loadPhotosFromStorage)())},[]),(0,o.useEffect)(()=>{l.length>0&&!(0,C.Yh)(l)&&s({title:"Storage Error",description:"Failed to save photos to local storage. Try clearing some space.",variant:"destructive"})},[l,s]),(0,o.useEffect)(()=>{u((0,C.yF)(l,t,n))},[t,n,l]);let k=(e,t)=>{t.stopPropagation(),c(t=>t.filter(t=>t.id!==e)),i.includes(e)&&r(e),s({title:"Photo Deleted",description:"The photo has been removed from your collection"})},S=async()=>{let e=l.filter(e=>!e.tags||0===e.tags.length);if(0===e.length){s({title:"No Action Needed",description:"All photos already have tags"});return}y(!0);try{let t=[...l];for(let a of e){let e=a.dataUrl||a.path;try{let o=await fetch("/api/image-description",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({imageData:e,headingContext:n||"",documentType:"property report"})});if(!o.ok)throw Error("API error: ".concat(o.status));let i=await o.json(),r=t.findIndex(e=>e.id===a.id);-1!==r&&(t[r]={...t[r],tags:i.tags||[]})}catch(e){console.error("Error generating tags for photo ".concat(a.id,":"),e)}}c(t),s({title:"Tags Generated",description:"Added tags to ".concat(e.length," photos")})}catch(e){console.error("Error generating tags:",e),s({title:"Generation Failed",description:"Could not generate tags for some photos",variant:"destructive"})}finally{y(!1)}};return(0,a.jsxs)("div",{className:"photo-grid-container flex flex-col h-full",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,a.jsxs)("div",{className:"flex space-x-2",children:[(0,a.jsxs)(j,{size:"sm",variant:"outline",onClick:()=>{var e;return null===(e=P.current)||void 0===e?void 0:e.click()},className:"text-xs",children:[(0,a.jsx)(m.Z,{className:"h-3.5 w-3.5 mr-1"}),"Upload"]}),(0,a.jsx)("input",{ref:P,type:"file",accept:"image/*",multiple:!0,className:"hidden",onChange:e=>{let t=e.target.files;t&&0!==t.length&&(Array.from(t).forEach(e=>{if(!e.type.startsWith("image/")){s({title:"Invalid File",description:"".concat(e.name," is not an image file"),variant:"destructive"});return}let t=new FileReader;t.onload=t=>{var n;if(null===(n=t.target)||void 0===n?void 0:n.result){let n={id:(0,C.iC)(),path:t.target.result,name:e.name,tags:[],dataUrl:t.target.result};c(e=>[...e,n]),s({title:"Photo Uploaded",description:"".concat(e.name," has been added to your collection")})}},t.onerror=()=>{s({title:"Upload Failed",description:"Failed to upload ".concat(e.name),variant:"destructive"})},t.readAsDataURL(e)}),P.current&&(P.current.value=""))}}),(0,a.jsxs)(j,{size:"sm",variant:"outline",onClick:S,disabled:b,className:"text-xs",children:[b?(0,a.jsx)(p.Z,{className:"h-3.5 w-3.5 mr-1 animate-spin"}):(0,a.jsx)(g.Z,{className:"h-3.5 w-3.5 mr-1"}),"Generate Tags"]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,a.jsx)(j,{size:"sm",variant:"ghost",onClick:()=>N(e=>Math.max(e-.25,.5)),disabled:w<=.5,children:(0,a.jsx)(f.Z,{className:"h-3.5 w-3.5"})}),(0,a.jsxs)("span",{className:"text-xs",children:[Math.round(100*w),"%"]}),(0,a.jsx)(j,{size:"sm",variant:"ghost",onClick:()=>N(e=>Math.min(e+.25,2)),disabled:w>=2,children:(0,a.jsx)(x.Z,{className:"h-3.5 w-3.5"})})]})]}),n&&(0,a.jsxs)("div",{className:"mb-3 px-2 py-1.5 bg-blue-50 rounded-md border border-blue-100 text-sm",children:[(0,a.jsx)("div",{className:"font-medium text-blue-800 text-xs mb-0.5",children:"Active section:"}),(0,a.jsx)("div",{className:"text-blue-700 text-xs",children:n})]}),(0,a.jsx)("div",{className:"flex-grow overflow-y-auto",children:(0,a.jsx)("div",{className:"grid gap-3",style:{gridTemplateColumns:"repeat(auto-fill, minmax(".concat(Math.max(120*w,80),"px, 1fr))")},children:0===d.length?(0,a.jsx)("div",{className:"col-span-3 text-center py-8 text-gray-400",children:t?"No photos match your search":"No photos available"}):d.map(e=>(0,a.jsxs)("div",{className:"relative rounded-md overflow-hidden cursor-pointer border ".concat(i.includes(e.id)?"border-blue-500 ring-2 ring-blue-300":"border-gray-200"," group transition-all hover:shadow-md"),"data-photo-id":e.id,onClick:t=>r(e.id,t.ctrlKey||t.metaKey),children:[(0,a.jsx)("div",{className:"aspect-w-4 aspect-h-3",children:(0,a.jsx)(h.default,{src:e.dataUrl||e.path,alt:e.name||"Photo ".concat(e.id),width:240,height:180,className:"w-full h-full object-cover",unoptimized:!!e.dataUrl})}),(0,a.jsxs)("div",{className:"p-1.5 bg-white",children:[(0,a.jsx)("div",{className:"flex flex-wrap gap-1 mb-1 max-h-8 overflow-hidden",children:e.tags&&e.tags.length>0?e.tags.map((e,t)=>(0,a.jsx)("span",{className:"px-1.5 py-0.5 bg-gray-100 rounded-sm text-[9px] text-gray-700 whitespace-nowrap",children:e},t)):(0,a.jsx)("span",{className:"text-[10px] text-gray-400",children:"No tags"})}),(0,a.jsx)("p",{className:"text-[9px] text-gray-400 truncate mt-1",title:e.name,children:e.name}),i.includes(e.id)&&i.length>1&&(0,a.jsx)("div",{className:"absolute bottom-1 left-1 bg-blue-500 text-white text-[10px] w-5 h-5 rounded-full flex items-center justify-center",children:i.indexOf(e.id)+1}),n&&e.relevance&&e.relevance>1&&(0,a.jsx)("div",{className:"absolute top-1 left-1 bg-yellow-500 text-white text-[10px] px-1.5 rounded-sm",children:e.relevance>3?"High":"Med"})]}),(0,a.jsx)("button",{className:"absolute top-1 right-1 p-1 rounded-full bg-white/80 opacity-0 group-hover:opacity-100 transition-opacity",onClick:t=>k(e.id,t),children:(0,a.jsx)(v.Z,{className:"h-3 w-3 text-red-500"})})]},e.id))})})]})}let k={WIDTH_INCHES:8.5,HEIGHT_INCHES:11,DPI:96,MARGIN_INCHES:1,get WIDTH_PX(){return this.WIDTH_INCHES*this.DPI},get HEIGHT_PX(){return this.HEIGHT_INCHES*this.DPI},get MARGIN_PX(){return this.MARGIN_INCHES*this.DPI}},S=async(e,t)=>{try{if(e){let n=I("Generating PDF...","Please wait while your document is prepared."),a=e.cloneNode(!0);a.classList.add("pdf-export-container"),a.querySelectorAll('.floating-menu, .bubble-menu, button, [role="button"], .tippy-box, .group-hover\\:opacity-100').forEach(e=>{e.parentNode&&e.parentNode.removeChild(e)}),a.querySelectorAll("p").forEach(e=>{e.style.fontSize="11pt",e.style.lineHeight="1.5",e.style.margin="0.5em 0"}),a.querySelectorAll("h1").forEach(e=>{e.style.fontSize="13pt",e.style.fontWeight="bold",e.style.margin="0.7em 0 0.3em"}),a.querySelectorAll("h2").forEach(e=>{e.style.fontSize="12pt",e.style.fontWeight="bold",e.style.margin="0.6em 0 0.3em"});let o=a.querySelectorAll(".page-container"),i=document.createElement("div");i.className="pdf-document",i.style.width="8.5in",i.style.margin="0 auto",i.style.backgroundColor="#fff";for(let e=0;e<o.length;e++){let t=o[e].cloneNode(!0);t.style.transform="none",t.style.position="relative",t.style.top="0",t.style.left="0",t.style.width="8.5in",t.style.height="11in",t.style.pageBreakAfter="always",t.style.margin="0",t.style.padding="0",t.style.boxSizing="border-box",t.style.overflow="hidden";let n=t.querySelector(".pdf-header");n&&(n.style.top="0.3in");let a=t.querySelector(".content-container");a&&(a.style.top="0.8in",a.style.bottom="0.6in",a.style.maxHeight="calc(11in - 1.4in)"),i.appendChild(t)}let r=function(e){let t=document.createElement("div");t.appendChild(e.cloneNode(!0));let n="";return document.querySelectorAll('link[rel="stylesheet"]').forEach(e=>{let t=e.href;t&&(n+='<link rel="stylesheet" href="'.concat(t,'">\n'))}),document.querySelectorAll("style").forEach(e=>{n+=e.outerHTML+"\n"}),'\n    <!DOCTYPE html>\n    <html>\n      <head>\n        <meta charset="utf-8">\n        <title>'.concat(document.title||"Document","</title>\n        ").concat(n,'\n        <style>\n          @page {\n            size: letter portrait;\n            margin: 0;\n          }\n          body {\n            margin: 0;\n            padding: 0;\n            background-color: white;\n          }\n          .page-container {\n            width: 8.5in;\n            height: 11in;\n            page-break-after: always;\n            position: relative;\n            margin: 0;\n            padding: 0;\n            overflow: hidden;\n            box-sizing: border-box;\n            border: none;\n          }\n          /* Ensure headers are positioned correctly */\n          .pdf-header {\n            position: absolute;\n            top: 0.3in;\n            left: 0.5in;\n            right: 0.5in;\n          }\n          /* Ensure content areas are properly sized */\n          .content-container {\n            position: absolute;\n            top: 0.8in;\n            left: 0.5in;\n            right: 0.5in;\n            bottom: 0.6in;\n            overflow: hidden;\n          }\n          /* Reset any potentially problematic styles */\n          * {\n            text-shadow: none !important;\n            box-shadow: none !important;\n          }\n          /* Hide any unwanted elements */\n          .no-print, button, [role="button"] {\n            display: none !important;\n          }\n        </style>\n      </head>\n      <body>\n        ').concat(t.innerHTML,"\n      </body>\n    </html>\n  ")}(i),s=new FormData;s.append("html",r),s.append("filename",t),s.append("isMultiPage","true");let l=await fetch("/api/generate-pdf",{method:"POST",body:s});if(n&&n.dismiss&&n.dismiss(),!l.ok)throw Error("PDF generation failed");let c=await l.blob(),d=URL.createObjectURL(c),u=document.createElement("a");return u.href=d,u.download=t,document.body.appendChild(u),u.click(),document.body.removeChild(u),URL.revokeObjectURL(d),I("PDF Generated","Your document has been downloaded."),!0}return console.error("Failed to export PDF: element not found or not in browser"),!1}catch(e){return console.error("Error exporting PDF:",e),I("PDF Generation Failed","There was an error creating your PDF.","destructive"),!1}};function I(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"default";console.log("".concat(e,": ").concat(t));try{let a=window.__toast;if("function"==typeof(null==a?void 0:a.toast))return a.toast({title:e,description:t,variant:n})}catch(e){console.warn("Toast system not available",e)}return{dismiss:()=>console.log("Toast dismissed")}}var A=n(4725),T=n(3200),L=n(4603),M=n(1190),D=n(7213),H=n(9006);let R=e=>{let[t,n]=(0,o.useState)("");return(0,o.useEffect)(()=>{if(!e)return;let a=()=>{if(e.isActive)try{let{from:a}=e.state.selection,o=e.state.doc,i="",r=-1;o.nodesBetween(0,a,(e,t)=>("heading"===e.type.name&&t>r&&t<=a&&(i=e.textContent,r=t),!0)),i&&i!==t&&(n(i),console.log("Active heading context updated:",i))}catch(e){console.error("Error extracting heading context:",e)}},o=()=>{a()};return a(),e.on("transaction",o),e.on("focus",a),e.on("update",a),()=>{e.off("transaction",o),e.off("focus",a),e.off("update",a)}},[e,t]),t};var F=n(1328),_=n(9680),z=n(7494),G=n(2489),Z=n(2023);let B=e=>{let{editor:t,selectedPhotoId:n,onGenerateText:i}=e,[r,s]=(0,o.useState)(!1),{toast:l}=(0,E.p)(),c=!!n,u=e=>{e.preventDefault(),e.stopPropagation();let n=t.options.element.getAttribute("data-editor-id")||Math.random().toString(36).substring(2,9),a=document.getElementById("ai-menu-".concat(n));if(!a){(a=document.createElement("div")).id="ai-menu-".concat(n),a.className="absolute left-0 top-8 bg-white rounded-md shadow-lg border border-gray-200 p-2 z-50 ai-menu-dropdown",a.style.minWidth="220px";let e=document.createElement("div");e.className="flex flex-col space-y-2",[{label:"Expand text",action:"expand"},{label:"Make text concise",action:"concise"},{label:"Fix grammar",action:"grammar"},{label:"Professional tone",action:"professional"}].forEach(t=>{let n=document.createElement("button");n.className="text-left px-2 py-1 hover:bg-gray-100 rounded text-sm",n.innerText=t.label,n.setAttribute("data-action",t.action),e.appendChild(n)});let o=document.createElement("div");o.className="border-t border-gray-200 my-1",e.appendChild(o);let r=document.createElement("div");r.className="mt-2";let d=document.createElement("label");d.className="block text-xs text-gray-500 mb-1",d.innerText="Custom instruction:";let u=document.createElement("input");u.className="w-full p-1 text-sm border border-gray-300 rounded",u.placeholder="E.g., Rewrite for 5th grade level",u.id="custom-prompt-".concat(n);let h=document.createElement("button");h.className="mt-1 w-full bg-yellow-500 hover:bg-yellow-600 text-white px-2 py-1 rounded text-sm",h.innerText="Apply Custom Prompt",h.setAttribute("data-action","custom"),r.appendChild(d),r.appendChild(u),r.appendChild(h),e.appendChild(r),e.querySelectorAll("button").forEach(e=>{e.addEventListener("mousedown",async o=>{o.preventDefault(),o.stopPropagation();let r=e.getAttribute("data-action");if(!r)return;s(!0);let d=t.options.element,u=document.createElement("div");u.className="ai-loading-indicator",u.innerHTML='\n            <div class="flex items-center gap-2">\n              <div class="ai-loading-spinner"></div>\n              <span class="text-sm font-medium">AI is enhancing your text...</span>\n            </div>\n          ',d.appendChild(u);try{let e;let{from:a,to:o}=t.state.selection,d=a!==o,h="";if(!(h=d?t.state.doc.textBetween(a,o):t.state.selection.$from.node().textContent)){l({title:"No text selected",description:"Please select some text to enhance.",variant:"destructive"}),u&&u.parentNode&&u.parentNode.removeChild(u),s(!1);return}if("custom"===r){let t=document.getElementById("custom-prompt-".concat(n));if(!(e=(null==t?void 0:t.value.trim())||void 0)){l({title:"No prompt provided",description:"Please enter a custom instruction.",variant:"destructive"});return}}if(!i){l({title:"Enhancement unavailable",description:"Text enhancement is not available.",variant:"destructive"});return}let m="";try{s(!0);let t=await i(h,e);if(!t)throw Error("No text was generated");m=t,s(!1)}catch(e){console.error("Error enhancing text:",e),l({title:"Enhancement failed",description:"Failed to enhance text. Please try again.",variant:"destructive"}),s(!1);return}if(m&&m!==h){if(d){t.chain().focus().deleteRange({from:a,to:o}).insertContent('<span class="ai-generated-text">'.concat(m,"</span>")).run();let e=m.length;setTimeout(()=>{t.commands.setTextSelection({from:a,to:a+e}),setTimeout(()=>{t.commands.setTextSelection(a+e)},600)},100)}else t.chain().focus().selectParentNode().deleteSelection().insertContent('<p><span class="ai-generated-text">'.concat(m,"</span></p>")).run(),setTimeout(()=>{t.commands.selectParentNode(),setTimeout(()=>{let{to:e}=t.state.selection;t.commands.setTextSelection(e)},600)},100);l({title:"AI Enhancement Applied",description:c?"Enhancement with photo context applied":"Text enhancement applied"})}}catch(e){console.error("Error applying AI enhancement:",e),l({title:"Enhancement failed",description:"There was an error enhancing your text with AI.",variant:"destructive"})}finally{s(!1),u&&u.parentNode&&u.parentNode.removeChild(u)}a.classList.add("hidden")})});let m=document.getElementById("custom-prompt-".concat(n));m&&(m.addEventListener("mousedown",e=>{e.stopPropagation()}),m.addEventListener("click",e=>{e.stopPropagation()}),m.addEventListener("keydown",async e=>{if("Enter"===e.key){e.preventDefault();let n=m.value.trim();if(!n){l({title:"No prompt provided",description:"Please enter a custom instruction.",variant:"destructive"});return}if(!i){l({title:"Enhancement unavailable",description:"Text enhancement is not available.",variant:"destructive"});return}s(!0);try{let{from:e,to:a}=t.state.selection,o=e!==a,r="";if(!(r=o?t.state.doc.textBetween(e,a):t.state.selection.$from.node().textContent)){l({title:"No text selected",description:"Please select some text to enhance.",variant:"destructive"}),s(!1);return}let d=await i(r,n);if(d&&d!==r){if(o){t.chain().focus().deleteRange({from:e,to:a}).insertContent(d).run();try{let e=t.view.dom.querySelector("p");e&&(e.classList.add("ai-highlight-effect"),setTimeout(()=>{e.classList.remove("ai-highlight-effect")},2e3))}catch(e){console.error("Could not apply highlight effect",e)}setTimeout(()=>{t.commands.setTextSelection({from:e,to:e+d.length})},50)}else{t.chain().focus().selectParentNode().deleteSelection().insertContent("<p>".concat(d,"</p>")).run();try{let e=t.view.dom.querySelector("p");e&&(e.classList.add("ai-highlight-effect"),setTimeout(()=>{e.classList.remove("ai-highlight-effect")},2e3))}catch(e){console.error("Could not apply highlight effect",e)}setTimeout(()=>{t.commands.selectParentNode()},50)}l({title:"AI Enhancement Applied",description:c?"Enhancement with photo context applied":"Custom enhancement applied"})}}catch(e){console.error("Error applying AI enhancement:",e),l({title:"Enhancement failed",description:"There was an error enhancing your text with AI.",variant:"destructive"})}finally{s(!1)}a.classList.add("hidden")}})),a.appendChild(e),document.body.appendChild(a)}let o=e.currentTarget.getBoundingClientRect(),r=document.querySelector(".ai-menu-container"),d=(null==r?void 0:r.getBoundingClientRect())||o;a.style.position="fixed",a.style.top="".concat(d.bottom+5,"px"),a.style.left="".concat(d.left,"px");let u=a.classList.contains("hidden");document.querySelectorAll(".ai-menu-dropdown").forEach(e=>{e.classList.add("hidden")}),u&&a.classList.remove("hidden")};return(0,a.jsxs)(T.NM,{editor:t,tippyOptions:{duration:100,hideOnClick:!1,trigger:"manual",onHide:e=>{var n;let a=document.activeElement;(null==a?void 0:null===(n=a.id)||void 0===n?void 0:n.includes("prompt-input"))&&setTimeout(()=>{let{from:n,to:a}=t.state.selection;n!==a&&e.show()},10)}},shouldShow:e=>{var t;let{editor:n}=e,{from:a,to:o}=n.state.selection,i=document.activeElement,r=null==i?void 0:null===(t=i.id)||void 0===t?void 0:t.includes("prompt-input");return a!==o||!!r},children:[(0,a.jsxs)("div",{className:"bg-white rounded-md shadow-lg border border-gray-200 p-1 flex items-center gap-1",children:[(0,a.jsx)(j,{size:"sm",variant:t.isActive("bold")?"default":"ghost",onClick:()=>t.chain().focus().toggleBold().run(),className:"h-7 w-7 p-0",children:(0,a.jsx)(F.Z,{className:"h-3.5 w-3.5"})}),(0,a.jsx)(j,{size:"sm",variant:t.isActive("italic")?"default":"ghost",onClick:()=>t.chain().focus().toggleItalic().run(),className:"h-7 w-7 p-0",children:(0,a.jsx)(_.Z,{className:"h-3.5 w-3.5"})}),(0,a.jsx)(j,{size:"sm",variant:t.isActive("underline")?"default":"ghost",onClick:()=>t.chain().focus().toggleStrike().run(),className:"h-7 w-7 p-0",children:(0,a.jsx)(z.Z,{className:"h-3.5 w-3.5"})}),(0,a.jsx)("div",{className:"mx-0.5 h-4 border-l border-gray-300"}),(0,a.jsx)(j,{size:"sm",variant:t.isActive("highlight")?"default":"ghost",onClick:()=>t.chain().focus().toggleHighlight().run(),className:"h-7 p-0 px-1",children:(0,a.jsx)("span",{className:"text-xs",children:"Highlight"})}),(0,a.jsx)("div",{className:"mx-0.5 h-4 border-l border-gray-300"}),(0,a.jsx)("div",{className:"ai-menu-container flex items-center",children:(0,a.jsxs)("div",{className:"flex items-center bg-white border border-gray-200 rounded-md",children:[(0,a.jsx)(j,{size:"sm",variant:"ghost","data-ai-dropdown-id":t.options.element.getAttribute("data-editor-id")||Math.random().toString(36).substring(2,9),className:"h-7 w-7 p-0 rounded-l-md rounded-r-none",disabled:r,onMouseDown:e=>{let{from:n,to:a}=t.state.selection,o=t.options.element.getAttribute("data-editor-id")||Math.random().toString(36).substring(2,9),i=document.getElementById("prompt-input-".concat(o));i&&n!==a&&(i.setAttribute("data-selection-from",n.toString()),i.setAttribute("data-selection-to",a.toString())),u(e),e.preventDefault()},children:(0,a.jsx)(d.Z,{className:"h-3.5 w-3.5"})}),(0,a.jsx)("input",{id:"prompt-input-".concat(t.options.element.getAttribute("data-editor-id")||Math.random().toString(36).substring(2,9)),type:"text",className:"h-7 border-0 border-l border-r border-gray-200 px-2 text-xs w-32 focus:outline-none",placeholder:"Type AI instruction...",onMouseDown:e=>{e.stopPropagation(),e.preventDefault(),e.currentTarget.focus()},onClick:e=>{e.stopPropagation()},onFocus:e=>{let{from:n,to:a}=t.state.selection;e.currentTarget.setAttribute("data-selection-from",n.toString()),e.currentTarget.setAttribute("data-selection-to",a.toString())},onInput:e=>{let n=parseInt(e.currentTarget.getAttribute("data-selection-from")||"0"),a=parseInt(e.currentTarget.getAttribute("data-selection-to")||"0");if(n&&a&&n!==a){let e=t.state.selection;(e.from!==n||e.to!==a)&&t.commands.setTextSelection({from:n,to:a})}},onKeyDown:e=>{if("Enter"===e.key){var n;e.preventDefault();let t=null===(n=e.currentTarget.parentElement)||void 0===n?void 0:n.querySelector("[data-generate-ai]");t&&t.click()}else"Escape"===e.key&&t.commands.focus()}}),(0,a.jsx)(j,{size:"sm",variant:"ghost",className:"h-7 w-7 rounded-l-none rounded-r-none border-r border-gray-200",onMouseDown:e=>{e.preventDefault(),e.stopPropagation();let n=t.options.element.getAttribute("data-editor-id")||Math.random().toString(36).substring(2,9),a=document.getElementById("prompt-input-".concat(n));if(a){a.value="",a.focus();let e=parseInt(a.getAttribute("data-selection-from")||"0"),n=parseInt(a.getAttribute("data-selection-to")||"0");e&&n&&e!==n&&t.commands.setTextSelection({from:e,to:n})}},children:(0,a.jsx)(G.Z,{className:"h-3 w-3"})}),(0,a.jsx)(j,{size:"sm",variant:"ghost","data-generate-ai":"true",className:"h-7 px-2 text-yellow-500 rounded-l-none rounded-r-md",disabled:r,onMouseDown:e=>{e.preventDefault(),e.stopPropagation();let{from:n,to:a}=t.state.selection,o=n!==a,r="";if(!(r=o?t.state.doc.textBetween(n,a):t.state.selection.$from.node().textContent)){l({title:"No text selected",description:"Please select some text to enhance.",variant:"destructive"});return}let c=t.options.element.getAttribute("data-editor-id")||Math.random().toString(36).substring(2,9),d=document.getElementById("prompt-input-".concat(c));if(d&&d.value){if(i){s(!0);let e=d.value;n!==a&&(d.setAttribute("data-selection-from",n.toString()),d.setAttribute("data-selection-to",a.toString())),i(r,e).then(e=>{if(e&&e!==r){if(o){t.commands.setTextSelection({from:n,to:a}),t.chain().focus().deleteRange({from:n,to:a}).insertContent(e).run();let o=n+e.length;try{let e=t.view.dom.querySelector("p");e&&(e.classList.add("ai-highlight-effect"),setTimeout(()=>{e.classList.remove("ai-highlight-effect")},2e3))}catch(e){console.error("Could not apply highlight effect",e)}setTimeout(()=>{t.commands.setTextSelection({from:n,to:o}),setTimeout(()=>{t.commands.setTextSelection(o)},600)},100)}else{t.chain().focus().selectParentNode().deleteSelection().insertContent("<p>".concat(e,"</p>")).run();try{let e=t.view.dom.querySelector("p");e&&(e.classList.add("ai-highlight-effect"),setTimeout(()=>{e.classList.remove("ai-highlight-effect")},2e3))}catch(e){console.error("Could not apply highlight effect",e)}setTimeout(()=>{t.commands.selectParentNode(),setTimeout(()=>{let{to:e}=t.state.selection;t.commands.setTextSelection(e)},600)},100)}l({title:"AI Enhancement Applied",description:"Text enhanced using your custom prompt"})}}).catch(()=>{l({title:"Enhancement failed",description:"Failed to enhance text. Please try again.",variant:"destructive"})}).finally(()=>{s(!1)})}}else{let e=new MouseEvent("mousedown",{bubbles:!0,cancelable:!0}),t=document.querySelector('[data-ai-dropdown-id="'.concat(c,'"]'));t&&t.dispatchEvent(e)}},children:(0,a.jsx)(Z.Z,{className:"h-3.5 w-3.5"})})]})})]}),r&&(0,a.jsx)("div",{className:"absolute inset-0 bg-white/80 flex items-center justify-center z-10",children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("div",{className:"ai-loading-spinner"}),(0,a.jsx)("span",{className:"text-sm font-medium",children:"AI is enhancing your text..."})]})})]})},X=e=>{let{editor:t}=e;return(0,a.jsx)("div",{className:"format-menu-container",children:(0,a.jsx)(j,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0 rounded-full border border-gray-200 bg-white shadow-sm hover:bg-gray-50",onMouseDown:e=>{e.preventDefault(),e.stopPropagation();let n=t.options.element.getAttribute("data-editor-id")||Math.random().toString(36).substring(2,9);t.options.element.getAttribute("data-editor-id")||t.options.element.setAttribute("data-editor-id",n);let a=document.getElementById("format-menu-".concat(n));a||((a=document.createElement("div")).id="format-menu-".concat(n),a.className="absolute left-8 top-0 bg-white rounded-md shadow-lg border border-gray-200 p-2 z-50 format-menu-dropdown",a.style.minWidth="180px",a.innerHTML='\n        <div class="flex flex-col space-y-1">\n          <!-- Paragraph -->\n          <button class="flex items-center justify-start rounded h-8 px-3 w-full text-left hover:bg-gray-100" data-action="paragraph">\n            <span class="text-sm">Text</span>\n          </button>\n          \n          <!-- Heading 1 -->\n          <button class="flex items-center justify-start rounded h-8 px-3 w-full text-left hover:bg-gray-100" data-action="heading1">\n            <span class="h-4 w-4 mr-2">\n              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="h-4 w-4"><path d="M6 12h12"/><path d="M6 20V4"/><path d="M18 20V4"/></svg>\n            </span>\n            <span class="text-lg font-bold">Heading 1</span>\n          </button>\n          \n          <!-- Heading 2 -->\n          <button class="flex items-center justify-start rounded h-8 px-3 w-full text-left hover:bg-gray-100" data-action="heading2">\n            <span class="h-4 w-4 mr-2">\n              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="h-4 w-4"><path d="M6 12h12"/><path d="M6 20V4"/><path d="M18 20V4"/></svg>\n            </span>\n            <span class="text-md font-bold">Heading 2</span>\n          </button>\n          \n          <!-- Heading 3 -->\n          <button class="flex items-center justify-start rounded h-8 px-3 w-full text-left hover:bg-gray-100" data-action="heading3">\n            <span class="h-4 w-4 mr-2">\n              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="h-4 w-4"><path d="M6 12h12"/><path d="M6 20V4"/><path d="M18 20V4"/></svg>\n            </span>\n            <span class="text-sm font-bold">Heading 3</span>\n          </button>\n          \n          <div class="border-t border-gray-200 my-1"></div>\n          \n          <!-- Bullet List -->\n          <button class="flex items-center justify-start rounded h-8 px-3 w-full text-left hover:bg-gray-100" data-action="bulletList">\n            <span class="h-4 w-4 mr-2">\n              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="h-4 w-4"><line x1="8" y1="6" x2="21" y2="6"></line><line x1="8" y1="12" x2="21" y2="12"></line><line x1="8" y1="18" x2="21" y2="18"></line><line x1="3" y1="6" x2="3.01" y2="6"></line><line x1="3" y1="12" x2="3.01" y2="12"></line><line x1="3" y1="18" x2="3.01" y2="18"></line></svg>\n            </span>\n            <span class="text-sm">Bullet List</span>\n          </button>\n          \n          <!-- Ordered List -->\n          <button class="flex items-center justify-start rounded h-8 px-3 w-full text-left hover:bg-gray-100" data-action="orderedList">\n            <span class="h-4 w-4 mr-2">\n              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="h-4 w-4"><line x1="10" y1="6" x2="21" y2="6"></line><line x1="10" y1="12" x2="21" y2="12"></line><line x1="10" y1="18" x2="21" y2="18"></line><path d="M4 6h1v4"></path><path d="M4 10h2"></path><path d="M6 18H4c0-1 2-2 2-3s-1-1.5-2-1"></path></svg>\n            </span>\n            <span class="text-sm">Ordered List</span>\n          </button>\n        </div>\n      ',a.addEventListener("mousedown",e=>{e.preventDefault(),e.stopPropagation();let n=e.target.closest("button");if(n){let e=n.getAttribute("data-action");"paragraph"===e?t.chain().focus().setParagraph().run():"heading1"===e?t.chain().focus().toggleHeading({level:1}).run():"heading2"===e?t.chain().focus().toggleHeading({level:2}).run():"heading3"===e?t.chain().focus().toggleHeading({level:3}).run():"bulletList"===e?t.chain().focus().toggleBulletList().run():"orderedList"===e&&t.chain().focus().toggleOrderedList().run(),a.classList.add("hidden")}}),document.body.appendChild(a));let o=e.currentTarget.getBoundingClientRect();a.style.position="fixed",a.style.top="".concat(o.top,"px"),a.style.left="".concat(o.left+30,"px");let i=a.classList.contains("hidden");document.querySelectorAll(".format-menu-dropdown").forEach(e=>{e.classList.add("hidden")}),i&&a.classList.remove("hidden")},children:(0,a.jsx)(c.Z,{className:"h-3 w-3"})})})},W=A.hj.create({name:"temporaryHighlight",addOptions:()=>({highlightClass:"ai-highlight-effect",duration:2e3}),addStorage:()=>({decorations:H.EH.empty,timeout:null}),addProseMirrorPlugins(){let e=new D.H$("temporaryHighlight"),t=this.storage;return[new D.Sy({key:e,state:{init:()=>({decorations:H.EH.empty,timeout:null}),apply:(e,t)=>t},props:{decorations:()=>t.decorations}})]}}),O=e=>{let{initialContent:t="<p>Start typing...</p>",onSave:n,onCancel:i,alwaysEditable:r=!1,selectedPhotoId:s,onGenerateText:l,onHeadingChange:c,onEditorReady:d}=e,u=(0,T.jE)({extensions:[L.Z.configure({heading:{levels:[1,2,3]}}),M.ZP,W],content:t,autofocus:"end",editorProps:{attributes:{class:"prose max-w-none focus:outline-none min-h-[50px] px-2 py-4 cursor-text mt-1",id:"editor-".concat(Date.now())},handleClick:()=>!1},onFocus:()=>{console.log("Editor focused")},onBlur:()=>{console.log("Editor blurred");let e=document.activeElement;!(e&&e.closest(".format-menu-container"))&&r&&requestAnimationFrame(()=>{u&&u.isEditable&&m()})},editable:!0}),{lastSavedAt:h,saveContent:m}=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1500,[a,i]=(0,o.useState)(null),r=(0,o.useCallback)(()=>{if(e&&t)try{let n=e.getHTML();t(n),i(new Date)}catch(e){console.error("Error saving content:",e)}},[e,t]);return(0,o.useEffect)(()=>{let t;if(!e)return;let a=()=>{t&&clearTimeout(t),t=setTimeout(()=>{e&&e.isEditable&&r()},n)};return e.on("update",a),()=>{e.off("update",a),t&&clearTimeout(t)}},[e,r,n]),{saveContent:r,lastSavedAt:a}}(u,n);!function(e,t,n){let a=(0,o.useCallback)(e=>{(e.ctrlKey||e.metaKey)&&"s"===e.key&&(e.preventDefault(),t&&t()),"Escape"===e.key&&(e.preventDefault(),n&&n())},[t,n]);(0,o.useEffect)(()=>(document.addEventListener("keydown",a),()=>{document.removeEventListener("keydown",a)}),[a])}(0,m,i),(0,o.useEffect)(()=>{if(u){console.log("Editor initialized successfully"),d&&d(u);let e=u.options.element;if(e){if(!e.getAttribute("data-editor-id")){let t=Math.random().toString(36).substring(2,9);e.setAttribute("data-editor-id",t)}let t=()=>{u.isFocused||u.commands.focus()};return e.addEventListener("click",t),e instanceof HTMLElement&&(e.style.zIndex="1"),()=>{e.removeEventListener("click",t)}}}},[u,d]),(0,o.useEffect)(()=>{let e=e=>{var t,n,a,o;(null===(t=e.target)||void 0===t?void 0:t.closest(".format-menu-container"))||(null===(n=e.target)||void 0===n?void 0:n.closest(".format-menu-dropdown"))||(null===(a=e.target)||void 0===a?void 0:a.closest(".ai-menu-container"))||(null===(o=e.target)||void 0===o?void 0:o.closest(".ai-menu-dropdown"))||document.querySelectorAll(".format-menu-dropdown, .ai-menu-dropdown").forEach(e=>{e.classList.add("hidden")})};return document.addEventListener("click",e),()=>{document.removeEventListener("click",e)}},[]),(0,o.useEffect)(()=>{if(u&&r){u.setEditable(!0);let e=e=>{u.options.element.contains(e.target)&&!u.isFocused&&u.commands.focus("end")};if(u.options.element)return u.options.element.addEventListener("click",e),()=>{u.options.element.removeEventListener("click",e)}}},[u,r]);let p=R(u);return((0,o.useEffect)(()=>{p&&c&&c(p)},[p,c]),u)?(0,a.jsxs)("div",{className:"relative editor-container ".concat(r?"always-editable":""),children:[h&&(0,a.jsx)("div",{className:"absolute top-2 right-2 text-xs text-gray-400 z-10",children:"Saved ".concat(h.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}))}),(null==u?void 0:u.isEmpty)&&!(null==u?void 0:u.isFocused)&&(0,a.jsx)("div",{className:"absolute top-4 left-2 text-gray-400 pointer-events-none cursor-text",children:"Click to edit text..."}),(0,a.jsxs)("div",{className:"relative ".concat(r?"always-editable-container":""),onClick:()=>{u&&!u.isFocused&&u.commands.focus("end")},children:[(0,a.jsxs)("div",{className:"flex",children:[(0,a.jsx)("div",{className:"w-10 flex-shrink-0 relative",children:(0,a.jsx)("div",{className:"absolute top-4 left-2",children:(0,a.jsx)(X,{editor:u})})}),(0,a.jsx)("div",{className:"flex-grow",children:(0,a.jsx)(T.kg,{editor:u})})]}),u&&(0,a.jsx)(B,{editor:u,selectedPhotoId:s,onGenerateText:l})]})]}):(0,a.jsx)("div",{className:"rounded-lg border border-gray-200 bg-white shadow-sm overflow-hidden relative p-8",children:(0,a.jsx)("div",{className:"flex items-center justify-center h-40",children:(0,a.jsx)("div",{className:"text-gray-500",children:"Loading editor..."})})})};var q=n(5277),U=n(4519),V=n(9747),Y=n(9022),J=n(7586),K=n(8645);let $=e=>{let{editor:t}=e;if(!t)return null;let n=[{name:"Text",icon:(0,a.jsx)(q.Z,{className:"h-4 w-4"}),isActive:()=>!1,onClick:()=>t.chain().focus().setParagraph().run()},{name:"Heading 1",icon:(0,a.jsx)(U.Z,{className:"h-4 w-4"}),isActive:()=>t.isActive("heading",{level:1}),onClick:()=>t.chain().focus().toggleHeading({level:1}).run()},{name:"Heading 2",icon:(0,a.jsx)(V.Z,{className:"h-4 w-4"}),isActive:()=>t.isActive("heading",{level:2}),onClick:()=>t.chain().focus().toggleHeading({level:2}).run()},{name:"Heading 3",icon:(0,a.jsx)(Y.Z,{className:"h-4 w-4"}),isActive:()=>t.isActive("heading",{level:3}),onClick:()=>t.chain().focus().toggleHeading({level:3}).run()},{name:"Bullet List",icon:(0,a.jsx)(J.Z,{className:"h-4 w-4"}),isActive:()=>!1,onClick:()=>t.chain().focus().toggleBulletList().run()},{name:"Ordered List",icon:(0,a.jsx)(K.Z,{className:"h-4 w-4"}),isActive:()=>!1,onClick:()=>t.chain().focus().toggleOrderedList().run()}];return(0,a.jsx)("div",{className:"format-toolbar border-t border-b border-gray-200 bg-white py-1 px-2 flex items-center space-x-1",children:n.map(e=>(0,a.jsx)(j,{variant:e.isActive()?"default":"ghost",size:"sm",className:"h-8 px-2 text-xs",onMouseDown:t=>{t.preventDefault(),e.onClick()},title:e.name,children:(0,a.jsxs)("span",{className:"flex items-center",children:[e.icon,(0,a.jsx)("span",{className:"ml-1",children:e.name})]})},e.name))})};function Q(e){return(0,a.jsx)(O,{...e})}var ee=n(8887);let et=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return"".concat(e).concat(Date.now(),"-").concat(Math.random().toString(36).substring(2,9))},en=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"standard",t="<p>Click to edit this page content...</p>";return"photo-appendix"===e&&(t='<h1 style="margin-top:0; margin-bottom:5px; padding:0; line-height:1.1;">Photographic Appendix</h1>'),{id:et("page-"),content:t,images:[],type:e}},ea=e=>{if(!e)return 1;let{scrollTop:t,clientHeight:n}=e;return Math.max(1,Math.ceil((t+n/2)/(k.HEIGHT_PX+40)))},eo=(e,t)=>{if(!e)return;let n=k.HEIGHT_PX+40;e.scrollTo({top:(t-1)*n,behavior:"smooth"})};function ei(e){let{page:t,pageNumber:n,header:i,logo:r,onRemoveImage:s,onGenerateImageDescription:l,onUpdateImageDescription:c,isGenerating:d=!1,children:u}=e,m=(0,o.useRef)(null);return(0,a.jsxs)("div",{className:"mx-auto bg-white shadow-md pdf-page",style:{width:"".concat(k.WIDTH_PX,"px"),height:"".concat(k.HEIGHT_PX,"px"),position:"relative",overflow:"hidden",pageBreakInside:"avoid",breakInside:"avoid",display:"block"},"data-page-id":t.id,children:[(0,a.jsx)("div",{className:"absolute pdf-header",style:{top:"photo-appendix"===t.type?"".concat(.15*k.MARGIN_PX,"px"):"".concat(.3*k.MARGIN_PX,"px"),left:"".concat(k.MARGIN_PX,"px"),right:"".concat(k.MARGIN_PX,"px")},children:(0,a.jsxs)("div",{className:"flex justify-between items-start",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-red-600 font-bold text-sm",children:i.companyName}),(0,a.jsx)("div",{className:"text-xs",children:i.documentTitle})]}),(0,a.jsx)("div",{children:r&&(0,a.jsx)(h.default,{src:r.url,alt:"Company Logo",width:.8*r.width,height:.8*r.height,priority:!0})})]})}),(0,a.jsxs)("div",{className:"absolute overflow-hidden content-container ".concat("photo-appendix"===t.type?"photo-appendix-content":""),style:{top:"photo-appendix"===t.type?"".concat(.9*k.MARGIN_PX,"px"):"".concat(.8*k.MARGIN_PX,"px"),left:"".concat(k.MARGIN_PX,"px"),right:"".concat(k.MARGIN_PX,"px"),bottom:"".concat(k.MARGIN_PX+20,"px"),maxHeight:"".concat(k.HEIGHT_PX-(k.MARGIN_PX+68),"px")},children:["photo-appendix"===t.type?(0,a.jsx)("div",{ref:m,className:"cursor-text always-editable-wrapper appendix-header-container",style:{pageBreakInside:"avoid",breakInside:"avoid",minHeight:"35px",height:"auto",marginBottom:"0",paddingBottom:"0",paddingTop:"0",marginTop:"0"},children:u}):(0,a.jsx)("div",{ref:m,className:"cursor-text min-h-[300px] always-editable-wrapper",style:{pageBreakInside:"avoid",breakInside:"avoid"},children:u}),t.images.length>0&&("photo-appendix"===t.type?(0,a.jsx)("div",{style:{marginTop:"4px"},className:"photo-grid-container",children:(0,a.jsx)("div",{className:"grid grid-cols-2 gap-6",children:t.images.map((e,t)=>(0,a.jsxs)("div",{className:"photo-appendix-item",children:[(0,a.jsxs)("div",{className:"mb-1 font-medium text-sm",children:["Photograph ",String(t+1).padStart(2,"0")]}),(0,a.jsx)("div",{className:"relative mb-2",style:{width:"100%",paddingBottom:"75%"},children:(0,a.jsxs)("div",{className:"absolute inset-0",children:[(0,a.jsx)("img",{src:e.url,alt:"Photograph ".concat(t+1),className:"w-full h-full object-cover rounded-md",style:{width:"100%",height:"100%",objectFit:"cover"}}),(0,a.jsx)("button",{className:"absolute top-2 right-2 bg-red-500 text-white rounded-full p-1",onClick:()=>s(e.id),children:(0,a.jsx)(G.Z,{className:"h-4 w-4"})})]})}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("div",{className:"text-xs mb-1 border border-transparent hover:border-gray-200 p-1 rounded",contentEditable:!0,suppressContentEditableWarning:!0,onBlur:t=>{c&&null!==t.currentTarget.textContent&&c(e.id,t.currentTarget.textContent)},children:e.description||"Description: View of property showing general condition."}),l&&(0,a.jsxs)("button",{className:"text-xs bg-blue-50 text-blue-600 px-2 py-1 rounded-md \n                                     hover:bg-blue-100 flex items-center mb-3\n                                     ".concat(d?"opacity-50 cursor-not-allowed":""),onClick:()=>l(e.id),disabled:d,children:[(0,a.jsxs)("svg",{className:"h-3 w-3 mr-1",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,a.jsx)("path",{d:"M9.5 14.5L12 12m0 0l2.5-2.5M12 12l-2.5-2.5M12 12l2.5 2.5"}),(0,a.jsx)("circle",{cx:"12",cy:"12",r:"10"})]}),d?"Generating...":"AI Description"]})]})]},e.id))})}):(0,a.jsx)("div",{className:"mt-4 grid grid-cols-2 gap-4",children:t.images.map(e=>(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("img",{src:e.url,alt:"Report image",className:"w-full h-auto rounded-md"}),(0,a.jsx)("button",{className:"absolute top-2 right-2 bg-red-500 text-white rounded-full p-1",onClick:()=>s(e.id),children:(0,a.jsx)(G.Z,{className:"h-4 w-4"})})]},e.id))}))]}),(0,a.jsxs)("div",{className:"absolute flex justify-between pdf-footer",style:{bottom:"".concat(.3*k.MARGIN_PX,"px"),left:"".concat(k.MARGIN_PX,"px"),right:"".concat(k.MARGIN_PX,"px")},children:[(0,a.jsx)("div",{className:"text-xs",children:(0,a.jsxs)("div",{children:["Project: ",i.projectNumber," | Issued: ",i.issueDate]})}),(0,a.jsxs)("div",{className:"text-xs",children:["Page ",n]})]})]})}let er=o.forwardRef((e,t)=>{let{className:n,type:o,...i}=e;return(0,a.jsx)("input",{type:o,className:(0,w.cn)("flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-base shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",n),ref:t,...i})});er.displayName="Input";var es=n(401);function el(e){let{header:t,onSave:n}=e,[i,r]=(0,o.useState)(!1),[s,c]=(0,o.useState)(t),d=(e,t)=>{c({...s,[e]:t})};return i?(0,a.jsxs)("div",{className:"p-4 border-b border-gray-200 bg-gray-50",children:[(0,a.jsx)("h3",{className:"text-md font-medium mb-3",children:"Edit Report Header"}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm text-gray-600 mb-1 block",children:"Company Name"}),(0,a.jsx)(er,{value:s.companyName,onChange:e=>d("companyName",e.target.value),className:"w-full"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm text-gray-600 mb-1 block",children:"Document Title"}),(0,a.jsx)(er,{value:s.documentTitle,onChange:e=>d("documentTitle",e.target.value),className:"w-full"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm text-gray-600 mb-1 block",children:"Project Number"}),(0,a.jsx)(er,{value:s.projectNumber,onChange:e=>d("projectNumber",e.target.value),className:"w-full"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm text-gray-600 mb-1 block",children:"Issue Date"}),(0,a.jsx)(er,{value:s.issueDate,onChange:e=>d("issueDate",e.target.value),className:"w-full"})]})]}),(0,a.jsxs)("div",{className:"flex justify-end space-x-2",children:[(0,a.jsxs)(j,{size:"sm",variant:"outline",onClick:()=>{c(t),r(!1)},className:"h-8 px-3",children:[(0,a.jsx)(G.Z,{className:"h-4 w-4 mr-1"}),"Cancel"]}),(0,a.jsxs)(j,{size:"sm",onClick:()=>{n(s),r(!1)},className:"h-8 px-3",children:[(0,a.jsx)(es.Z,{className:"h-4 w-4 mr-1"}),"Save Changes"]})]})]}):(0,a.jsxs)("div",{className:"flex justify-between items-center p-2 border-b border-gray-200",children:[(0,a.jsx)("div",{className:"text-sm font-medium",children:t.documentTitle}),(0,a.jsx)(j,{size:"sm",variant:"ghost",onClick:()=>r(!0),className:"h-8 w-8 p-0 rounded-full",children:(0,a.jsx)(l.Z,{className:"h-4 w-4"})})]})}let ec={getProcessedImage:async e=>{try{let t=document.querySelector('[data-photo-id="'.concat(e,'"]'));if(t){let e=t.querySelector("img");if(e){let t=e.src;return await ed(t)}}let a=document.querySelector('img[src*="'.concat(e,'"]'));if(a)return await ed(a.src);try{if(e.includes("/")||e.includes("."))return await ed(e)}catch(e){console.error("Error treating ID as URL:",e)}try{let{loadPhotosFromStorage:t}=await Promise.resolve().then(n.bind(n,1397)),a=t().find(t=>t.id===e);if(a&&(a.dataUrl||a.path)){let e=a.dataUrl||a.path;return await ed(e)}}catch(e){console.error("Error loading from storage:",e)}throw Error("Image not found by any method")}catch(e){throw console.error("Error processing image:",e),e}}},ed=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:800,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:600,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.7;return new Promise((o,i)=>{let r=new Image;r.crossOrigin="anonymous",r.onload=()=>{let s=r.width,l=r.height;console.log("Original image dimensions: ".concat(s,"x").concat(l)),s>t&&(l=Math.round(t/s*l),s=t),l>n&&(s=Math.round(n/l*s),l=n),console.log("Resized dimensions: ".concat(s,"x").concat(l));let c=document.createElement("canvas");c.width=s,c.height=l;let d=c.getContext("2d");if(!d){i(Error("Could not get canvas context"));return}d.fillStyle="#FFFFFF",d.fillRect(0,0,s,l),d.drawImage(r,0,0,s,l);let u=c.toDataURL("image/jpeg",a);if(!u.startsWith("data:image/jpeg;base64,")){console.error("Invalid data URL format generated"),i(Error("Invalid data URL format"));return}console.log("Processed image size: ".concat(u.length," bytes")),u.length>5e5?(console.log("Image is still large, applying more aggressive compression"),o(ed(e,640,480,.5))):o(u)},r.onerror=e=>{console.error("Image load error:",e),i(Error("Failed to load image"))},r.src=e})},eu={generateText:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";try{let n=await fetch("/api/ai",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({systemPrompt:"You are a professional report writer for property inspection reports. \n                        Use professional, technical language that is concise and factual.",userPrompt:"".concat(t||"Write a detailed technical paragraph",".\n                      ").concat(e?'The current text is: "'.concat(e,'"'):"","\n                      The text should be factual, professional, and provide relevant observations.")})});if(!n.ok)throw Error("API error: ".concat(n.status));return(await n.json()).content}catch(e){throw console.error("Text generation error:",e),e}},generateTextWithImage:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2?arguments[2]:void 0;try{let a=await fetch("/api/ai",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({systemPrompt:"You are a professional report writer for property inspection reports. \n                        Use professional, technical language that is concise and factual.\n                        Analyze the image in detail and incorporate your observations in your response.",userPrompt:"".concat(t||"Write a technical description"," \n                      of the image I'm sharing with you.\n                      ").concat(e?'The current text is: "'.concat(e,'"'):"","\n                      The text should be factual, professional, and provide relevant observations about what's shown."),includePhoto:!0,photoData:n})});if(!a.ok)throw Error("API error: ".concat(a.status));return(await a.json()).content}catch(e){throw console.error("Image-based text generation error:",e),e}}};function eh(){let[e,t]=(0,o.useState)([]),[n,h]=(0,o.useState)(""),[m,p]=(0,o.useState)(!1),[g,f]=(0,o.useState)(!1),[x,v]=(0,o.useState)(""),[b,y]=(0,o.useState)(!1),[w,N]=(0,o.useState)(null),[I,A]=(0,o.useState)(null),T=(0,o.useRef)(new Map),L=(0,o.useRef)(null);(0,o.useEffect)(()=>{console.log("Active heading context in unified editor:",x)},[x]),(0,o.useEffect)(()=>{if(!b)return;let e=e=>{L.current&&L.current.contains(e.target)||y(!1)};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[b]);let[M,D]=(0,o.useState)(()=>[{id:"custom-page-".concat(Date.now()),content:"<p>Start typing...</p>",images:[]}]),[H,R]=(0,o.useState)({companyName:"Halton Condominium Corporation No. XX",documentTitle:"Class 1/2/3 Comprehensive/Updated Reserve Fund Study",projectNumber:"RZ1324-0XXX-00",issueDate:"June 1, 2020"}),[F,_]=(0,o.useState)(!1),[z,G]=(0,o.useState)(1),[Z,B]=(0,o.useState)(1),X=(0,o.useRef)(null),W=(0,o.useRef)(null),{toast:O}=(0,E.p)(),q={url:"https://hebbkx1anhila5yf.public.blob.vercel-storage.com/Cion-2022_logo-ai-EX34VT0pWcJr3Q13MkaRjWcjee98lR.svg",width:100,height:40};(0,o.useEffect)(()=>{G(Math.max(1,M.length));let e=()=>G(Math.max(1,M.length));return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[M]),(0,o.useEffect)(()=>{let e=0,t=()=>{let t=Date.now();if(t-e<150||(e=t,!X.current))return;let n=ea(X.current);if(n!==Z&&n>0){B(n);let e=n-1;if(M[e]){let t=M[e].id,n=T.current.get(t);if(n){var a;N(n),A(t);let e=n.getAttributes("heading").level&&(null===(a=n.state.doc.textContent.split("\n")[0])||void 0===a?void 0:a.trim())||"";e?(console.log('Setting heading context from scroll: "'.concat(e,'"')),v(e)):v("")}}}},n=X.current;return n&&n.addEventListener("scroll",t,{passive:!0}),()=>{n&&n.removeEventListener("scroll",t)}},[Z,M]),(0,o.useEffect)(()=>{let e=X.current;if(!e)return;let t=t=>{t.target===e&&(t.preventDefault(),t.stopPropagation())};return e.addEventListener("click",t),()=>e.removeEventListener("click",t)},[]);let U=(0,ee.MG)({count:z,getScrollElement:()=>X.current,estimateSize:()=>k.HEIGHT_PX+40,overscan:3,measureElement:e=>e.getBoundingClientRect().height}),V=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"standard";D([...M,en(e)]),N(null),A(null),v(""),setTimeout(()=>{X.current&&eo(X.current,M.length+1)},100),O({title:"photo-appendix"===e?"Photo Appendix Added":"Page Added",description:"photo-appendix"===e?"A new photo appendix page has been added to your report.":"A new page has been added to your report."})},Y=()=>{if(0===e.length){O({title:"No Photo Selected",description:"Please select a photo from the left panel first.",variant:"destructive"});return}f(!0),O({title:"Insert Photo",description:"Click on a page to insert the selected photo."})},J=n=>{if(0===e.length){O({title:"No Photo Selected",description:"Please select a photo from the left panel first.",variant:"destructive"});return}let a=e=>{let t=(0,C.loadPhotosFromStorage)().find(t=>t.id===e);return t?t.dataUrl||t.path:"/placeholder.svg?height=200&width=200"};D(t=>t.map(t=>{if(t.id===n){if("photo-appendix"===t.type){let n=e.map((e,t)=>{let n=a(e);return{id:"image-".concat(Date.now(),"-").concat(t),url:n,width:400,height:300,description:"Description: View of property showing general condition.",originalPhotoId:e}});return console.log("Adding photos to appendix:",n),{...t,images:[...t.images,...n]}}{let n=a(e[0]),o={id:"image-".concat(Date.now()),url:n,width:400,height:300,originalPhotoId:e[0]};return console.log("Adding photo to standard page:",o),{...t,images:[...t.images,o]}}}return t})),t([]),O({title:"Photo Added",description:"The selected photo has been added to the page."})},K=(e,t)=>{D(n=>n.map(n=>n.id===e?{...n,images:n.images.filter(e=>e.id!==t)}:n))},et=async()=>{if(W.current)try{O({title:"Exporting PDF",description:"Please wait while we generate your PDF..."}),await S(W.current,"Report-".concat(H.projectNumber,".pdf"))&&O({title:"PDF Exported",description:"Your report has been exported as a PDF successfully."})}catch(e){console.error("PDF export error:",e),O({title:"Export Failed",description:"There was an error exporting your report to PDF.",variant:"destructive"})}},er=async function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";try{let a;if(p(!0),e.length>0){if(1===e.length){let o=await ec.getProcessedImage(e[0]);a=await eu.generateTextWithImage(t,n||"Write a technical description",o)}else{let o=e.map(e=>ec.getProcessedImage(e)),i=(await Promise.allSettled(o)).filter(e=>"fulfilled"===e.status).map(e=>e.value);if(i.length>0){let e=i[0],o=i.length,r="".concat(n||"Write a technical description"," based on ").concat(o," photos. \n                                      I'm sharing the primary photo, but please write a description that could \n                                      encompass multiple similar items in this category.");a=await eu.generateTextWithImage(t,r,e)}else throw Error("Failed to process any of the selected photos")}}else a=await eu.generateText(t,n||"Write a detailed technical paragraph");return O({title:"AI text generated",description:e.length>0?"AI-generated text based on ".concat(1===e.length?"the selected photo":"selected photos"," has been created."):"AI-generated text has been created."}),a}catch(e){return console.error("Text generation error:",e),O({title:"Generation failed",description:"Failed to generate text. Please try again.",variant:"destructive"}),null}finally{p(!1)}},es=async(e,t)=>{let n=M.find(t=>t.id===e);if(!n)return;let a=n.images.find(e=>e.id===t);if(a&&a.originalPhotoId)try{p(!0),O({title:"Generating Description",description:"Creating one sentence description for this photo as if you were a building engineer"});let n=await ec.getProcessedImage(a.originalPhotoId),o=await eu.generateTextWithImage("","Write a short, concise property inspection description",n);D(n=>n.map(n=>n.id===e?{...n,images:n.images.map(e=>e.id===t?{...e,description:o}:e)}:n)),O({title:"Description Generated",description:"AI-generated description has been added to the photo."})}catch(e){console.error("Photo description generation error:",e),O({title:"Generation Failed",description:"Could not generate a description for this photo.",variant:"destructive"})}finally{p(!1)}},ed=(e,t,n)=>{D(a=>a.map(a=>a.id===e?{...a,images:a.images.map(e=>e.id===t?{...e,description:n}:e)}:a))},eh=(e,t)=>{D(n=>n.map(n=>n.id===e?{...n,content:t}:n))};return(0,a.jsxs)("div",{className:"flex h-screen",children:[(0,a.jsxs)("div",{className:"w-1/3 border-r border-gray-200 overflow-y-auto p-4 bg-gray-50",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,a.jsx)("h1",{className:"text-xl font-bold text-gray-900",children:"Photos"}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("button",{className:"p-2 rounded-full hover:bg-gray-200",title:"Insert Photo",onClick:Y,disabled:0===e.length,children:(0,a.jsx)(i.Z,{className:"h-5 w-5 ".concat(0===e.length?"text-gray-400":"text-blue-600")})}),(0,a.jsx)("button",{className:"p-2 rounded-full hover:bg-gray-200",title:"Export to PDF",onClick:et,children:(0,a.jsx)(r.Z,{className:"h-5 w-5 text-gray-600"})}),(0,a.jsx)("button",{className:"p-2 rounded-full hover:bg-gray-200",title:"Print",onClick:()=>window.print(),children:(0,a.jsx)(s.Z,{className:"h-5 w-5 text-gray-600"})})]})]}),(0,a.jsx)("div",{className:"mb-4",children:(0,a.jsx)("input",{type:"text",placeholder:"Filter photos...",className:"w-full p-2 bg-white border border-gray-300 rounded-md",value:n,onChange:e=>h(e.target.value)})}),(0,a.jsx)(P,{filterQuery:n,headingContext:x,selectedPhotos:e,onSelectPhoto:function(n){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e.includes(n)?t(e.filter(e=>e!==n)):a?t([...e,n]):t([n])}})]}),(0,a.jsxs)("div",{className:"w-2/3 flex flex-col bg-white overflow-hidden",children:[(0,a.jsx)("div",{className:"bg-gray-50 border-b border-gray-200",children:(0,a.jsxs)("div",{className:"p-2 flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"text-sm",children:["Page ",Z," of ",z]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsxs)(j,{size:"sm",variant:g?"default":"outline",onClick:Y,disabled:0===e.length,children:[(0,a.jsx)(i.Z,{className:"h-4 w-4 mr-1"}),"Insert Photo"]}),(0,a.jsxs)(j,{size:"sm",onClick:()=>{_(!0),N(null),A(null),v("")},children:[(0,a.jsx)(l.Z,{className:"h-4 w-4 mr-1"}),"Edit Header"]}),(0,a.jsxs)(j,{size:"sm",onClick:et,children:[(0,a.jsx)(r.Z,{className:"h-4 w-4 mr-1"}),"Export PDF"]})]})]})}),(0,a.jsx)("div",{className:"relative",style:{zIndex:b?50:1},children:(0,a.jsxs)("div",{className:"format-toolbar-container flex ".concat(w&&I?"active":"inactive"),onClick:e=>{e.stopPropagation()},children:[(0,a.jsx)("div",{className:"flex items-center pl-2 border-r border-gray-200 pr-2 add-page-container",children:(0,a.jsxs)("div",{className:"relative",ref:L,children:[(0,a.jsxs)("div",{className:"flex",children:[(0,a.jsxs)(j,{size:"sm",variant:"secondary",onClick:()=>V("standard"),className:"rounded-r-none border-r-0 bg-blue-50 hover:bg-blue-100 text-blue-600",children:[(0,a.jsx)(c.Z,{className:"h-4 w-4 mr-1"}),"Add Page"]}),(0,a.jsx)(j,{size:"sm",variant:"secondary",className:"rounded-l-none px-1 bg-blue-50 hover:bg-blue-100 text-blue-600",onClick:e=>{e.stopPropagation(),y(!b)},children:(0,a.jsx)(d.Z,{className:"h-4 w-4"})})]}),b&&(0,a.jsxs)("div",{className:"absolute top-full left-0 mt-1 bg-white shadow-lg rounded-md border border-gray-200 py-1 z-50",onClick:e=>e.stopPropagation(),children:[(0,a.jsxs)("button",{className:"w-full text-left px-3 py-2 text-sm hover:bg-gray-100 flex items-center",onClick:()=>{V("standard"),y(!1)},children:[(0,a.jsx)(c.Z,{className:"h-3.5 w-3.5 mr-2"}),"Standard Page"]}),(0,a.jsxs)("button",{className:"w-full text-left px-3 py-2 text-sm hover:bg-gray-100 flex items-center",onClick:()=>{V("photo-appendix"),y(!1)},children:[(0,a.jsx)(u.Z,{className:"h-3.5 w-3.5 mr-2"}),"Photo Appendix"]})]})]})}),(0,a.jsx)("div",{className:"flex-grow",children:w&&I?(0,a.jsx)($,{editor:w}):(0,a.jsx)("div",{className:"format-toolbar text-gray-400 text-xs py-2 text-center",children:"Select text to use formatting options"})})]})}),F&&(0,a.jsx)(el,{header:H,onSave:e=>{if(R(e),_(!1),M.length>0&&T.current.size>0){let e=M[0].id,n=T.current.get(e);if(n){var t;N(n),A(e);let a=n.getAttributes("heading").level&&(null===(t=n.state.doc.textContent.split("\n")[0])||void 0===t?void 0:t.trim())||"";a?(console.log('Restoring heading context after header edit: "'.concat(a,'"')),v(a)):v("")}}O({title:"Header Updated",description:"Report header information has been updated."})}}),(0,a.jsx)("div",{ref:X,className:"flex-1 overflow-y-auto page-scroller",style:{width:"100%",height:"100%",background:"#f0f0f0"},children:(0,a.jsx)("div",{ref:W,style:{height:"".concat(U.getTotalSize(),"px"),width:"100%",position:"relative"},children:U.getVirtualItems().map(t=>{let n=t.index,o=n+1,r=M[n];return(0,a.jsx)("div",{ref:e=>U.measureElement(e),style:{position:"absolute",top:0,left:0,width:"100%",height:"".concat(k.HEIGHT_PX,"px"),transform:"translateY(".concat(t.start,"px)"),cursor:g?"copy":"default"},"data-page-number":o,className:"page-container ".concat(g?"photo-insertion-mode":""),id:"page-".concat(o),onClick:()=>{g&&(J(r.id),f(!1))},children:(0,a.jsx)(ei,{page:r,pageNumber:o,header:H,logo:q,onRemoveImage:e=>K(r.id,e),onGenerateImageDescription:e=>es(r.id,e),onUpdateImageDescription:(e,t)=>ed(r.id,e,t),isGenerating:m,children:(0,a.jsxs)("div",{className:"relative",children:[e.length>0&&(0,a.jsxs)("div",{className:"absolute top-2 right-2 bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded-full z-10 flex items-center",children:[(0,a.jsx)(i.Z,{className:"h-3 w-3 mr-1"}),1===e.length?"Photo selected for AI":"".concat(e.length," photos selected for AI")]}),(0,a.jsx)(Q,{initialContent:r.content,onSave:e=>eh(r.id,e),alwaysEditable:!0,selectedPhotoId:e.length>0?e[0]:void 0,onGenerateText:er,onHeadingChange:e=>{e&&""!==e.trim()&&r.id===I?(console.log('Setting active heading context: "'.concat(e,'" from page ').concat(r.id)),v(e)):r.id!==I&&e&&""!==e.trim()&&console.log('Ignoring heading change "'.concat(e,'" from inactive page ').concat(r.id))},onEditorReady:e=>{T.current.set(r.id,e);let t=()=>{var t;N(e),A(r.id);let n=e.getAttributes("heading").level&&(null===(t=e.state.doc.textContent.split("\n")[0])||void 0===t?void 0:t.trim())||"";n&&(v(n),console.log('Setting active heading context on focus: "'.concat(n,'"'))),console.log("Editor for page ".concat(r.id," is now active"))},a=e.options.element;return a.addEventListener("focus",t,!0),0!==n||w||(N(e),A(r.id)),()=>{a.removeEventListener("focus",t,!0),T.current.delete(r.id)}}})]})})},t.key)})})})]})]})}},7992:function(e,t,n){"use strict";n.d(t,{p:function(){return i}});var a=n(2265);let o=0;function i(){let[e,t]=(0,a.useState)([]);return{toast:function(e){let{title:n,description:a,action:i,variant:r}=e,s="".concat(o++),l={id:s,title:n,description:a,action:i,variant:r};return t(e=>[...e,l]),setTimeout(()=>{t(e=>e.filter(e=>e.id!==s))},5e3),{id:s,dismiss:()=>t(e=>e.filter(e=>e.id!==s)),update:e=>{t(t=>t.map(t=>t.id===s?{...t,...e}:t))}}},toasts:e,dismiss:e=>{e?t(t=>t.filter(t=>t.id!==e)):t([])}}}},4508:function(e,t,n){"use strict";n.d(t,{cn:function(){return i}});var a=n(1994),o=n(3335);function i(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,o.m6)((0,a.W)(t))}}},function(e){e.O(0,[572,902,63,3,971,117,744],function(){return e(e.s=124)}),_N_E=e.O()}]);